# Sprint 7: 多语言转写与翻译支持（Week 15-16）

### 目标
支持多语言转写，并在转写非中文内容时自动进行全文翻译，提升国际化使用体验。

### User Stories

#### US-7.1 多语言转写支持
**作为** 用户
**我想要** 在转写时选择目标语言
**以便** 准确转写不同语言的音频内容

**验收标准**:
- [ ] 上传文件时，前端显示语言选择界面（支持中文、英文、日语等常见语言）
- [ ] 语言选择信息随文件上传请求传递到后端
- [ ] 后端将目标语言参数传递给转写引擎（Faster-Whisper）
- [ ] 转写结果能够正确识别并转写所选语言的内容
- [ ] 数据库存储目标语言信息，便于后续查询和管理

**任务拆解**:
- [ ] Task-7.1.1: 设计语言选择 UI（下拉菜单或按钮组），包含常见语言选项（中文、英文、日语、韩语、法语、德语、西班牙语等）（2h）
- [ ] Task-7.1.2: 修改上传 API，接收并存储目标语言参数（`target_language`）（2h）
- [ ] Task-7.1.3: 修改数据库 schema，在 `media_files` 表中添加 `target_language` 字段（1h）
- [ ] Task-7.1.4: 修改队列处理逻辑，将目标语言传递给 Python Worker（2h）
- [ ] Task-7.1.5: 修改 Python Worker，支持指定语言参数调用 Faster-Whisper（3h）
- [ ] Task-7.1.6: 测试各种语言的转写准确性（3h）

---

#### US-7.2 非中文内容自动翻译
**作为** 用户
**我想要** 转写非中文内容时自动获得中文翻译
**以便** 快速理解外语内容，无需手动翻译

**验收标准**:
- [ ] 当目标语言为非中文时，在转写完成后自动触发翻译流程
- [ ] 翻译使用 Ollama（或指定 LLM）进行全文翻译
- [ ] 翻译结果保存为独立字段，与原始转写内容分离
- [ ] 前端可以切换显示原始转写内容或翻译内容
- [ ] 翻译失败时给出错误提示，但不影响原始转写结果的显示

**任务拆解**:
- [ ] Task-7.2.1: 设计翻译 Prompt 模板，确保翻译准确性和格式一致性（2h）
- [ ] Task-7.2.2: 修改队列处理逻辑，在转写完成后检测目标语言，非中文时触发翻译（3h）
- [ ] Task-7.2.3: 实现翻译服务接口，调用 Ollama 进行全文翻译（4h）
- [ ] Task-7.2.4: 修改数据库 schema，在 `transcriptions` 表中添加 `translated_content` 字段（2h）
- [ ] Task-7.2.5: 修改前端 TranscriptionResult 组件，支持切换显示原始/翻译内容（4h）
- [ ] Task-7.2.6: 处理翻译失败场景，提供重试机制（2h）
- [ ] Task-7.2.7: 优化翻译性能，支持长文本分段翻译（3h）

---

### Sprint 7 总结
- **总估时**: 约 33-38 小时
- **关键交付物**:
  - ✅ 多语言转写选择界面与后端支持
  - ✅ 非中文内容自动翻译功能
  - ✅ 原始内容与翻译内容的切换显示
  - ✅ 翻译失败处理与重试机制

