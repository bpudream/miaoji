# 妙记 MVP 开发任务清单

## 项目概览

**项目目标**: 完成可用的 MVP 版本，实现音视频转写和 AI 总结的核心功能

**开发周期**: 8-10 周（5 个 Sprint）

**团队规模**: 1-2 人

**技术栈**: Windows 后端 (Node.js + Python) + Web 前端 (React)

---

## Sprint 3: 前端基础开发（Week 7-8）

### 目标
开发前端界面，实现文件上传、转写和结果展示

### User Stories

#### US-3.1 前端项目配置
**作为** 前端开发者
**我想要** 完整的前端开发环境
**以便** 开始 UI 开发

**验收标准**:
- [ ] React + TypeScript 项目运行正常
- [ ] Tailwind CSS 配置完成
- [ ] 路由和状态管理就绪

**任务拆解**:
- [ ] Task-3.1.1: 安装和配置 Tailwind CSS（1h）
- [ ] Task-3.1.2: 安装 React Router（30min）
- [ ] Task-3.1.3: 安装 Zustand 状态管理（30min）
- [ ] Task-3.1.4: 安装 axios 和 socket.io-client（30min）
- [ ] Task-3.1.5: 创建基础布局组件（2h）
  - Header, Sidebar, MainContent
- [ ] Task-3.1.6: 配置路由结构（1h）
  ```
  / - 首页/项目列表
  /project/:id - 项目详情
  /settings - 设置
  ```

---

#### US-3.2 API 客户端封装
**作为** 前端开发者
**我想要** 封装好的 API 客户端
**以便** 方便调用后端接口

**验收标准**:
- [ ] axios 统一配置
- [ ] 错误处理统一
- [ ] 类型定义完整

**任务拆解**:
- [ ] Task-3.2.1: 创建 API 客户端基类（2h）
  ```typescript
  // services/api.ts
  const api = axios.create({
    baseURL: 'http://localhost:8080'
  });
  ```
- [ ] Task-3.2.2: 实现项目相关 API（2h）
  - uploadFile, getProjects, getProject, deleteProject
- [ ] Task-3.2.3: 实现转写相关 API（1h）
  - startTranscription, getTranscription, getStatus
- [ ] Task-3.2.4: 添加请求拦截器（1h）
  - 添加 token（如果有认证）
  - 统一错误处理
- [ ] Task-3.2.5: 创建 TypeScript 类型定义（2h）

---

#### US-3.3 文件上传界面
**作为** 用户
**我想要** 简单易用的文件上传界面
**以便** 快速上传音视频文件

**验收标准**:
- [ ] 支持拖拽上传
- [ ] 支持文件选择器
- [ ] 显示上传进度
- [ ] 文件格式验证

**任务拆解**:
- [ ] Task-3.3.1: 创建 FileUploader 组件（3h）
  ```tsx
  <FileUploader
    onUpload={handleUpload}
    onProgress={handleProgress}
  />
  ```
- [ ] Task-3.3.2: 实现拖拽上传功能（2h）
- [ ] Task-3.3.3: 实现上传进度显示（2h）
  - 进度条
  - 百分比
  - 预估剩余时间
- [ ] Task-3.3.4: 添加文件类型验证（1h）
- [ ] Task-3.3.5: 美化 UI 样式（2h）

---

#### US-3.4 项目列表页面
**作为** 用户
**我想要** 查看所有上传的项目
**以便** 选择和管理它们

**验收标准**:
- [ ] 显示项目列表
- [ ] 显示项目状态（pending/processing/completed）
- [ ] 支持删除操作
- [ ] 点击项目进入详情

**任务拆解**:
- [ ] Task-3.4.1: 创建 ProjectList 组件（3h）
- [ ] Task-3.4.2: 实现项目卡片组件（2h）
  ```tsx
  <ProjectCard
    project={project}
    onDelete={handleDelete}
    onClick={handleClick}
  />
  ```
- [ ] Task-3.4.3: 实现状态筛选（1h）
- [ ] Task-3.4.4: 实现排序功能（1h）
- [ ] Task-3.4.5: 添加空状态提示（1h）
- [ ] Task-3.4.6: 实现分页（2h）

---

#### US-3.5 转写详情页面
**作为** 用户
**我想要** 查看转写结果
**以便** 阅读和使用文字内容

**验收标准**:
- [ ] 显示转写文本
- [ ] 显示时间戳
- [ ] 支持文本复制
- [ ] 转写中显示进度

**任务拆解**:
- [ ] Task-3.5.1: 创建 ProjectDetail 页面（2h）
- [ ] Task-3.5.2: 创建转写结果展示组件（3h）
  ```tsx
  <TranscriptionView
    segments={segments}
    isLoading={isLoading}
  />
  ```
- [ ] Task-3.5.3: 实现分段显示（2h）
  - 每个分段显示时间和文本
- [ ] Task-3.5.4: 添加开始转写按钮（1h）
- [ ] Task-3.5.5: 实现转写进度显示（2h）
  - 进度条
  - 状态提示
- [ ] Task-3.5.6: 添加复制功能（1h）

---

#### US-3.6 Zustand 状态管理
**作为** 前端开发者
**我想要** 统一的状态管理
**以便** 在各组件间共享数据

**验收标准**:
- [ ] Store 结构清晰
- [ ] 异步操作处理完善
- [ ] TypeScript 类型安全

**任务拆解**:
- [ ] Task-3.6.1: 创建 useAppStore（3h）
  ```typescript
  interface AppState {
    projects: Project[];
    currentProject: Project | null;
    // ...
  }
  ```
- [ ] Task-3.6.2: 实现项目相关 actions（2h）
  - loadProjects, selectProject, deleteProject
- [ ] Task-3.6.3: 实现转写相关 actions（2h）
  - startTranscription, loadTranscription
- [ ] Task-3.6.4: 添加 loading 和 error 状态（1h）

---

**Sprint 3 总结**:
- **总估时**: 约 45-50 小时
- **关键交付物**:
  - ✅ 前端基础界面
  - ✅ 文件上传功能
  - ✅ 项目列表和详情页

---

## Sprint 4: WebSocket 实时通信与 LLM 集成（Week 9-10）

### 目标
实现 WebSocket 实时推送和 AI 总结功能

### User Stories

#### US-4.1 WebSocket 服务端
**作为** 后端开发者
**我想要** WebSocket 实时通信
**以便** 推送转写进度

**验收标准**:
- [ ] Socket.io 服务正常运行
- [ ] 支持房间（room）管理
- [ ] 连接状态管理完善

**任务拆解**:
- [ ] Task-4.1.1: 安装 socket.io（30min）
  ```bash
  npm install socket.io
  ```
- [ ] Task-4.1.2: 集成 Socket.io 到 Fastify（2h）
- [ ] Task-4.1.3: 实现房间管理（2h）
  - 用户加入项目房间
  - 订阅/取消订阅
- [ ] Task-4.1.4: 实现进度推送（2h）
  ```typescript
  io.to(projectId).emit('progress', { stage, progress });
  ```
- [ ] Task-4.1.5: 连接认证（可选）（1h）

---

#### US-4.2 WebSocket 客户端
**作为** 前端开发者
**我想要** WebSocket 客户端
**以便** 接收实时更新

**验收标准**:
- [ ] 自动连接和重连
- [ ] 监听进度事件
- [ ] 错误处理完善

**任务拆解**:
- [ ] Task-4.2.1: 安装 socket.io-client（15min）
- [ ] Task-4.2.2: 创建 WebSocket 服务类（2h）
  ```typescript
  class WebSocketService {
    connect()
    subscribeToProject(projectId)
    onProgress(callback)
  }
  ```
- [ ] Task-4.2.3: 实现自动重连（1h）
- [ ] Task-4.2.4: 集成到 Zustand store（1h）
- [ ] Task-4.2.5: 添加连接状态指示器（1h）

---

#### US-4.3 实时进度显示
**作为** 用户
**我想要** 看到实时的转写进度
**以便** 了解处理状态

**验收标准**:
- [ ] 进度百分比实时更新
- [ ] 显示当前处理阶段
- [ ] 估算剩余时间

**任务拆解**:
- [ ] Task-4.3.1: 修改转写流程发送进度（2h）
  - 音频提取进度
  - 转写进度
- [ ] Task-4.3.2: 创建进度组件（2h）
  ```tsx
  <ProgressBar
    progress={progress}
    stage={stage}
  />
  ```
- [ ] Task-4.3.3: 实现阶段指示器（1h）
  - 音频提取 -> 转写中 -> 完成
- [ ] Task-4.3.4: 添加剩余时间估算（2h）

---

#### US-4.4 Ollama LLM 集成
**作为** 后端开发者
**我想要** 集成 Ollama 服务
**以便** 实现 AI 总结功能

**验收标准**:
- [ ] Ollama 服务自动管理
- [ ] API 调用正常工作
- [ ] 支持流式输出

**任务拆解**:
- [ ] Task-4.4.1: 创建 OllamaService 类（3h）
  ```typescript
  class OllamaService {
    async ensureRunning()
    async generate(prompt)
    async generateStream(prompt)
  }
  ```
- [ ] Task-4.4.2: 实现 Prompt 模板（2h）
  - 摘要生成 prompt
  - 要点提取 prompt
- [ ] Task-4.4.3: 实现流式输出（2h）
- [ ] Task-4.4.4: 错误处理和重试（2h）
- [ ] Task-4.4.5: 性能优化（1h）

---

#### US-4.5 AI 总结 API
**作为** 前端开发者
**我想要** 调用 AI 总结 API
**以便** 生成内容摘要

**验收标准**:
- [ ] POST /api/projects/:id/summarize
- [ ] 支持不同总结类型
- [ ] 返回结构化结果

**任务拆解**:
- [ ] Task-4.5.1: 实现总结 API 接口（3h）
- [ ] Task-4.5.2: 实现不同总结模式（3h）
  - 简短摘要
  - 详细摘要
  - 要点提取
- [ ] Task-4.5.3: 保存总结结果到数据库（1h）
- [ ] Task-4.5.4: 实现获取总结结果接口（1h）
  - GET /api/projects/:id/summary

---

#### US-4.6 总结结果展示
**作为** 用户
**我想要** 查看 AI 生成的总结
**以便** 快速了解内容要点

**验收标准**:
- [ ] 显示摘要内容
- [ ] 显示要点列表
- [ ] 支持重新生成

**任务拆解**:
- [ ] Task-4.6.1: 创建 SummaryPanel 组件（3h）
  ```tsx
  <SummaryPanel
    summary={summary}
    onRegenerate={handleRegenerate}
  />
  ```
- [ ] Task-4.6.2: 实现生成按钮和loading状态（1h）
- [ ] Task-4.6.3: 实现总结内容展示（2h）
- [ ] Task-4.6.4: 添加复制和导出功能（1h）
- [ ] Task-4.6.5: 实现流式显示（可选）（2h）

---

**Sprint 4 总结**:
- **总估时**: 约 45-50 小时
- **关键交付物**:
  - ✅ WebSocket 实时通信
  - ✅ AI 总结功能完整

---

## Sprint 5: 功能完善与部署（Week 11-12）

### 目标
完善 MVP 功能，优化性能，部署到生产环境

### User Stories

#### US-5.1 文本编辑功能
**作为** 用户
**我想要** 编辑转写结果
**以便** 修正错误

**验收标准**:
- [ ] 可以编辑文本
- [ ] 自动保存
- [ ] 保留时间戳

**任务拆解**:
- [ ] Task-5.1.1: 实现文本编辑器组件（4h）
- [ ] Task-5.1.2: 实现自动保存（2h）
- [ ] Task-5.1.3: 实现更新 API（2h）
  - PUT /api/projects/:id/transcription
- [ ] Task-5.1.4: 添加撤销/重做功能（2h）

---

#### US-5.2 导出功能
**作为** 用户
**我想要** 导出转写结果
**以便** 在其他软件中使用

**验收标准**:
- [ ] 支持 TXT 格式
- [ ] 支持 JSON 格式
- [ ] 支持 SRT 字幕格式（可选）

**任务拆解**:
- [ ] Task-5.2.1: 实现导出 API（3h）
  - GET /api/projects/:id/export?format=txt
- [ ] Task-5.2.2: 实现 TXT 导出（1h）
- [ ] Task-5.2.3: 实现 JSON 导出（1h）
- [ ] Task-5.2.4: 实现 SRT 导出（2h）
- [ ] Task-5.2.5: 前端添加导出按钮（1h）

---

#### US-5.3 错误处理优化
**作为** 用户
**我想要** 友好的错误提示
**以便** 知道发生了什么问题

**验收标准**:
- [ ] 所有错误都有提示
- [ ] 提示信息清晰易懂
- [ ] 提供解决建议

**任务拆解**:
- [ ] Task-5.3.1: 统一错误代码（2h）
- [ ] Task-5.3.2: 实现 Toast 提示组件（2h）
- [ ] Task-5.3.3: 添加错误边界（1h）
- [ ] Task-5.3.4: 完善各接口错误处理（3h）

---

#### US-5.4 性能优化
**作为** 开发者
**我想要** 优化应用性能
**以便** 提供更好的用户体验

**验收标准**:
- [ ] 前端加载时间 < 2s
- [ ] API 响应时间 < 100ms
- [ ] GPU 利用率 > 80%

**任务拆解**:
- [ ] Task-5.4.1: 前端代码分割（2h）
- [ ] Task-5.4.2: 图片和资源优化（1h）
- [ ] Task-5.4.3: API 响应缓存（2h）
- [ ] Task-5.4.4: 数据库查询优化（2h）
- [ ] Task-5.4.5: GPU 使用优化（3h）
  - 批处理优化
  - 内存管理

---

#### US-5.5 部署配置
**作为** 开发者
**我想要** 在生产环境部署应用
**以便** 实际使用

**验收标准**:
- [ ] PM2 配置完成
- [ ] 可以开机自启动
- [ ] 日志正常记录

**任务拆解**:
- [ ] Task-5.5.1: 创建 ecosystem.config.js（1h）
  ```javascript
  module.exports = {
    apps: [{
      name: 'miaoji-server',
      script: 'dist/server.js',
      instances: 1,
      exec_mode: 'fork',
      env: { NODE_ENV: 'production' }
    }]
  };
  ```
- [ ] Task-5.5.2: 配置环境变量（1h）
- [ ] Task-5.5.3: 编写启动脚本（1h）
- [ ] Task-5.5.4: 配置 PM2 开机自启（1h）
- [ ] Task-5.5.5: 配置 Windows 防火墙（30min）
- [ ] Task-5.5.6: 编写部署文档（2h）

---

#### US-5.6 测试与文档
**作为** 开发者
**我想要** 完整的测试和文档
**以便** 保证质量和可维护性

**验收标准**:
- [ ] 核心功能有单元测试
- [ ] API 文档完整
- [ ] 用户手册完成

**任务拆解**:
- [ ] Task-5.6.1: 编写后端单元测试（4h）
- [ ] Task-5.6.2: 编写前端组件测试（4h）
- [ ] Task-5.6.3: 编写 API 文档（2h）
- [ ] Task-5.6.4: 编写用户手册（3h）
- [ ] Task-5.6.5: 编写开发者文档（2h）

---

#### US-5.7 安全加固
**作为** 开发者
**我想要** 增强系统的安全性
**以便** 防止未授权访问和恶意攻击

**验收标准**:
- [ ] CORS 策略仅限受信任的来源
- [ ] 增加 API 速率限制 (Rate Limiting)
- [ ] 上传文件类型和大小的严格后端校验
- [ ] (可选) 简单的 API Token 认证机制

**任务拆解**:
- [ ] Task-5.7.1: 配置严格的 CORS 规则（允许 localhost 和局域网 IP 段）
- [ ] Task-5.7.2: 集成 @fastify/rate-limit 防止暴力请求
- [ ] Task-5.7.3: 完善文件上传的安全校验（Magic Number 检查文件头）
- [ ] Task-5.7.4: 实现简单的 Authorization Header 校验（如果在非家庭环境使用）

---

**Sprint 5 总结**:
- **总估时**: 约 50-55 小时
- **关键交付物**:
  - ✅ MVP 功能完整
  - ✅ 性能优化完成
  - ✅ 部署到生产环境
  - ✅ 文档完善

---

## 项目总结

### 总体时间估算
- **Sprint 0**: 30-35 小时（环境搭建）
- **Sprint 1**: 40-45 小时（后端基础）
- **Sprint 2**: 55-60 小时（AI 核心）
- **Sprint 3**: 45-50 小时（前端基础）
- **Sprint 4**: 45-50 小时（实时通信 + LLM）
- **Sprint 5**: 50-55 小时（完善与部署）

**总计**: 265-295 小时（约 8-10 周，按每周 30-35 小时计算）

### MVP 验收标准

#### 功能性
- [ ] 用户可以上传音视频文件
- [ ] 系统可以自动转写为文字（中英文）
- [ ] 用户可以查看和编辑转写结果
- [ ] 系统可以生成 AI 总结
- [ ] 用户可以导出结果（TXT, JSON）
- [ ] 支持局域网内多设备访问

#### 性能
- [ ] 转写速度 ≥10x 实时速度
- [ ] GPU 利用率 >70%
- [ ] API 响应时间 <100ms
- [ ] 前端加载时间 <2s

#### 稳定性
- [ ] 无严重 Bug
- [ ] 错误处理完善
- [ ] 日志记录完整
- [ ] 可以稳定运行 24 小时

### 风险管理

| 风险 | 概率 | 影响 | 应对措施 |
|------|------|------|---------|
| GPU 驱动问题 | 中 | 高 | 提前测试，准备 CPU 降级方案 |
| Python 集成问题 | 中 | 中 | 充分的技术验证（Sprint 0） |
| 性能不达标 | 低 | 高 | 持续性能监控和优化 |
| 时间超期 | 中 | 中 | 优先保证核心功能，次要功能延后 |

### 后续迭代计划（v1.1+）

#### 高优先级
- 音频同步播放
- 批量处理
- 更多导出格式（DOCX, PDF）
- 说话人分离

#### 中优先级
- 实时转写（麦克风）
- 多用户管理
- 自定义 Prompt
- 性能监控面板

#### 低优先级
- 移动端 App（独立项目）
- 云端备份
- 插件系统

---

## 附录

### 开发环境检查清单
```bash
# Node.js
node --version  # >= 18.0.0

# Python
python --version  # >= 3.10

# CUDA
nvcc --version  # >= 11.8
nvidia-smi  # 检查 GPU

# FFmpeg
ffmpeg -version

# Ollama
ollama --version
```

### 常用命令
```bash
# 后端开发
cd server
npm run dev

# 前端开发
cd web
npm run dev

# Python Worker 测试
cd server/python
python asr_worker.py

# 生产部署
pm2 start ecosystem.config.js
pm2 logs
pm2 monit
```

### 目录结构参考
```
miaoji/
├── server/
│   ├── src/
│   │   ├── api/
│   │   │   ├── projects.ts
│   │   │   ├── transcription.ts
│   │   │   └── summary.ts
│   │   ├── services/
│   │   │   ├── AudioExtractor.ts
│   │   │   ├── WorkerManager.ts
│   │   │   └── OllamaService.ts
│   │   ├── database/
│   │   │   ├── schema.sql
│   │   │   └── Database.ts
│   │   ├── utils/
│   │   └── server.ts
│   ├── python/
│   │   ├── asr_worker.py
│   │   └── requirements.txt
│   ├── uploads/
│   ├── dist/
│   └── package.json
│
├── web/
│   ├── src/
│   │   ├── components/
│   │   │   ├── FileUploader.tsx
│   │   │   ├── ProjectList.tsx
│   │   │   ├── TranscriptionView.tsx
│   │   │   └── SummaryPanel.tsx
│   │   ├── pages/
│   │   │   ├── HomePage.tsx
│   │   │   ├── ProjectDetailPage.tsx
│   │   │   └── SettingsPage.tsx
│   │   ├── services/
│   │   │   ├── api.ts
│   │   │   └── websocket.ts
│   │   ├── stores/
│   │   │   └── useAppStore.ts
│   │   ├── App.tsx
│   │   └── main.tsx
│   ├── public/
│   └── package.json
│
├── docs/
│   ├── 0.需求分析.md
│   ├── 1.技术架构设计.md
│   └── 2.MVP任务清单.md
│
└── README.md
```

---

**祝开发顺利！🚀**

