# 妙记 MVP 开发任务清单

## 项目概览

**项目目标**: 完成可用的 MVP 版本，实现音视频转写和 AI 总结的核心功能

**开发周期**: 8-10 周（5 个 Sprint）

**团队规模**: 1-2 人

**技术栈**: Windows 后端 (Node.js + Python) + Web 前端 (React)

---

## Sprint 0: 环境搭建与技术验证（Week 1-2）

### 目标
验证核心技术可行性，搭建开发环境，初始化项目结构

### User Stories

#### US-0.1 开发环境配置
**作为** 开发者
**我想要** 配置完整的开发环境
**以便** 可以开始项目开发

**验收标准**:
- [ ] Node.js 18+ 已安装并配置
- [ ] Python 3.10+ 已安装并配置
- [ ] CUDA 11.8+ 和 cuDNN 已安装
- [ ] Git 版本控制已配置
- [ ] VSCode 开发环境已配置

**任务拆解**:
- [x] Task-0.1.1: 安装 Node.js 18 LTS（30min） - [Done: 2025-11-19]
- [x] Task-0.1.2: 安装 Python 3.10+（30min） - [Done: 2025-11-19]
- [x] Task-0.1.3: 安装 CUDA Toolkit 11.8 和 cuDNN（1h） - [Done: 2025-11-20] (实际安装 CUDA 12.6 + cuDNN 9)
- [x] Task-0.1.4: 配置 Git 和 GitHub（30min） - [Done: 2025-11-19]
- [x] Task-0.1.5: 安装 VSCode 和必要插件（30min） - [Done: 2025-11-19]
  - ESLint, Prettier, Python, TypeScript
- [x] Task-0.1.6: 配置 Python 虚拟环境（30min） - [Done: 2025-11-20]

---

#### US-0.2 faster-whisper 技术验证
**作为** 开发者
**我想要** 验证 faster-whisper 在本地 GPU 上的性能
**以便** 确认技术方案可行

**验收标准**:
- [ ] faster-whisper 可以正常加载模型
- [ ] GPU 加速正常工作（CUDA 可用）
- [ ] 测试音频转写准确率 ≥90%
- [ ] 转写速度 ≥10x 实时速度

**任务拆解**:
- [x] Task-0.2.1: 安装 faster-whisper 库（30min） - [Done: 2025-11-20]
  ```bash
  pip install faster-whisper
  ```
- [x] Task-0.2.2: 编写测试脚本验证 CUDA（1h） - [Done: 2025-11-20]
- [x] Task-0.2.3: 下载 Whisper large-v3 模型（30min） - [Done: 2025-11-20] (手动下载)
- [x] Task-0.2.4: 测试中文音频转写（2h） - [Done: 2025-11-20]
- [x] Task-0.2.5: 测试英文音频转写（1h） - [Cancelled: 2025-11-20] (中文效果已验证 GPU 性能，无需重复测试)
- [x] Task-0.2.6: 性能基准测试并记录（2h） - [Done: 2025-11-20]
  - 测试不同长度音频（1分钟、5分钟、30分钟）
  - 记录转写速度、GPU 使用率、内存占用
  - 结果: 10分钟音频耗时 47.75s (12.5x 实时速度)

---

#### US-0.3 Ollama + Qwen3 技术验证
**作为** 开发者
**我想要** 验证 Ollama 本地 LLM 的性能
**以便** 确认 AI 总结功能可行

**验收标准**:
- [x] Ollama 服务可以正常启动
- [x] Qwen3:8b 模型加载成功
- [x] GPU 推理速度 ≥40 tokens/s
- [x] 中文总结质量可接受

**任务拆解**:
- [x] Task-0.3.1: 下载并安装 Ollama（30min） - [Done: 2025-11-20]
- [x] Task-0.3.2: 下载 Qwen3:8b 模型（1h） - [Done: 2025-11-20]
  ```bash
  ollama pull qwen3:8b
  ```
- [x] Task-0.3.3: 测试 API 调用（1h） - [Done: 2025-11-20]
- [x] Task-0.3.4: 测试不同长度文本的总结（2h） - [Done: 2025-11-20]
- [x] Task-0.3.5: 性能基准测试（1h） - [Done: 2025-11-20]
  - 测试 tokens/s
  - 测试 GPU 占用
  - 测试响应时间: 12秒完成总结

---

#### US-0.4 FFmpeg 集成验证
**作为** 开发者
**我想要** 验证 FFmpeg 音频提取功能
**以便** 确认可以处理各种格式的音视频文件

**验收标准**:
- [ ] FFmpeg 已安装并可用
- [ ] 可以提取 MP4 视频中的音频
- [ ] 输出格式为 16kHz 单声道 WAV

**任务拆解**:
- [x] Task-0.4.1: 下载并安装 FFmpeg（30min） - [Done: 2025-11-20] (本地已配置)
- [x] Task-0.4.2: 测试命令行音频提取（1h） - [Done: 2025-11-20] (测试转写时已隐式验证)
- [x] Task-0.4.3: 测试不同格式视频文件（2h） - [Cancelled: 2025-11-20] (后续集成时测试)

---

#### US-0.5 项目结构初始化
**作为** 开发者
**我想要** 创建标准的项目结构
**以便** 开始编码

**验收标准**:
- [ ] Monorepo 项目结构创建完成
- [ ] 前端项目可以启动（React）
- [ ] 后端项目可以启动（Node.js）
- [ ] TypeScript 配置正确

**任务拆解**:
- [x] Task-0.5.1: 初始化 Git 仓库（15min） - [Done: 2025-11-20]
- [ ] Task-0.5.2: 创建项目目录结构（30min）
  ```
  miaoji/
  ├── server/
  ├── web/
  ├── docs/
  └── README.md
  ```
- [ ] Task-0.5.3: 初始化后端项目（1h）
  ```bash
  cd server
  npm init -y
  npm install typescript @types/node fastify
  npx tsc --init
  ```
- [ ] Task-0.5.4: 初始化前端项目（1h）
  ```bash
  cd web
  npm create vite@latest . -- --template react-ts
  npm install
  ```
- [ ] Task-0.5.5: 配置 ESLint 和 Prettier（1h）
- [ ] Task-0.5.6: 编写基础的 README 和 .gitignore（30min）

---

**Sprint 0 总结**:
- **总估时**: 约 30-35 小时
- **关键里程碑**:
  - ✅ 核心技术验证完成
  - ✅ 开发环境就绪
  - ✅ 项目结构初始化

---

## Sprint 1: 后端基础架构（Week 3-4）

### 目标
搭建后端 API 服务器，实现文件上传和基础数据库功能

### User Stories

#### US-1.1 创建 Fastify API 服务器
**作为** 后端开发者
**我想要** 搭建基础的 API 服务器
**以便** 提供 RESTful API

**验收标准**:
- [ ] Fastify 服务器可以启动
- [ ] 监听 8080 端口
- [ ] 支持 CORS（跨域）
- [ ] 基础路由结构清晰

**任务拆解**:
- [ ] Task-1.1.1: 安装 Fastify 及相关插件（30min）
  ```bash
  npm install fastify @fastify/cors @fastify/multipart
  ```
- [ ] Task-1.1.2: 创建服务器入口文件 `server.ts`（1h）
- [ ] Task-1.1.3: 配置 CORS 中间件（30min）
- [ ] Task-1.1.4: 创建路由目录结构（1h）
  ```
  server/src/
  ├── api/
  │   ├── projects.ts
  │   └── health.ts
  ├── services/
  ├── database/
  └── server.ts
  ```
- [ ] Task-1.1.5: 实现健康检查端点 `/api/health`（30min）
- [ ] Task-1.1.6: 编写服务器启动脚本（30min）

---

#### US-1.2 文件上传功能
**作为** 用户
**我想要** 上传音视频文件到服务器
**以便** 进行转写处理

**验收标准**:
- [ ] 支持 multipart/form-data 上传
- [ ] 文件大小限制 5GB
- [ ] 支持的格式验证（MP3, MP4, WAV 等）
- [ ] 上传进度可追踪

**任务拆解**:
- [ ] Task-1.2.1: 配置 @fastify/multipart（1h）
- [ ] Task-1.2.2: 创建上传目录管理（1h）
  - 每个项目一个子目录
  - 自动清理临时文件
- [ ] Task-1.2.3: 实现 `POST /api/projects` 接口（3h）
  - 接收文件
  - 验证文件类型
  - 保存到磁盘
  - 返回项目 ID
- [ ] Task-1.2.4: 实现文件类型验证（1h）
  ```typescript
  const ALLOWED_TYPES = [
    'audio/mpeg', 'audio/wav', 'video/mp4', ...
  ];
  ```
- [ ] Task-1.2.5: 添加文件大小限制（30min）
- [ ] Task-1.2.6: 错误处理和日志记录（1h）

---

#### US-1.3 SQLite 数据库集成
**作为** 后端开发者
**我想要** 使用 SQLite 存储项目数据
**以便** 持久化保存转写结果

**验收标准**:
- [ ] SQLite 数据库文件创建成功
- [ ] 数据库 schema 定义完整
- [ ] CRUD 操作可以正常工作

**任务拆解**:
- [ ] Task-1.3.1: 安装 better-sqlite3（30min）
  ```bash
  npm install better-sqlite3 @types/better-sqlite3
  ```
- [ ] Task-1.3.2: 设计数据库 schema（2h）
  ```sql
  -- projects 表
  -- transcriptions 表
  -- summaries 表
  ```
- [ ] Task-1.3.3: 创建数据库初始化脚本（2h）
- [ ] Task-1.3.4: 实现 Database 类封装（3h）
  ```typescript
  class Database {
    createProject()
    getProject()
    updateProject()
    deleteProject()
    saveTranscription()
    // ...
  }
  ```
- [ ] Task-1.3.5: 编写数据库单元测试（2h）
- [ ] Task-1.3.6: 实现数据库迁移机制（2h）

---

#### US-1.4 项目管理 API
**作为** 前端开发者
**我想要** 完整的项目管理 API
**以便** 在前端展示和操作项目

**验收标准**:
- [ ] GET /api/projects - 获取项目列表
- [ ] GET /api/projects/:id - 获取单个项目
- [ ] DELETE /api/projects/:id - 删除项目
- [ ] 支持分页和排序

**任务拆解**:
- [ ] Task-1.4.1: 实现获取项目列表接口（2h）
  - 支持分页（page, pageSize）
  - 支持排序（按创建时间）
  - 支持状态筛选
- [ ] Task-1.4.2: 实现获取单个项目接口（1h）
- [ ] Task-1.4.3: 实现删除项目接口（2h）
  - 删除数据库记录
  - 删除相关文件
- [ ] Task-1.4.4: 添加请求参数验证（1h）
- [ ] Task-1.4.5: 编写 API 文档（1h）

---

#### US-1.5 日志和错误处理
**作为** 开发者
**我想要** 完善的日志和错误处理
**以便** 方便调试和监控

**验收标准**:
- [ ] 使用 Pino 记录日志
- [ ] 统一的错误处理中间件
- [ ] 日志分级（info, error, debug）
- [ ] 日志文件轮转

**任务拆解**:
- [ ] Task-1.5.1: 安装和配置 Pino（1h）
  ```bash
  npm install pino pino-pretty
  ```
- [ ] Task-1.5.2: 创建日志工具类（2h）
- [ ] Task-1.5.3: 实现全局错误处理中间件（2h）
- [ ] Task-1.5.4: 添加请求日志（1h）
- [ ] Task-1.5.5: 配置日志文件存储（1h）

---

**Sprint 1 总结**:
- **总估时**: 约 40-45 小时
- **关键交付物**:
  - ✅ API 服务器运行
  - ✅ 文件上传功能
  - ✅ 数据库集成
  - ✅ 基础 CRUD API

---

## Sprint 2: AI 处理核心功能（Week 5-6）

### 目标
集成 faster-whisper 和 FFmpeg，实现音频提取和转写功能

### User Stories

#### US-2.1 FFmpeg 音频提取服务
**作为** 系统
**我想要** 从视频中提取音频
**以便** 进行语音识别

**验收标准**:
- [ ] 支持多种视频格式
- [ ] 输出 16kHz 单声道 WAV
- [ ] 提取进度可追踪
- [ ] 错误处理完善

**任务拆解**:
- [ ] Task-2.1.1: 安装 fluent-ffmpeg（30min）
  ```bash
  npm install fluent-ffmpeg @types/fluent-ffmpeg
  ```
- [ ] Task-2.1.2: 创建 AudioExtractor 服务类（3h）
  ```typescript
  class AudioExtractor {
    async extract(videoPath: string): Promise<string>
  }
  ```
- [ ] Task-2.1.3: 实现进度回调（2h）
- [ ] Task-2.1.4: 添加错误处理和重试逻辑（2h）
- [ ] Task-2.1.5: 测试不同格式视频（2h）
- [ ] Task-2.1.6: 性能优化（1h）

---

#### US-2.2 Python Worker 集成
**作为** 后端开发者
**我想要** 创建 Python Worker 进程
**以便** 运行 AI 模型

**验收标准**:
- [ ] Python Worker 可以启动和停止
- [ ] Node.js 和 Python 通信正常
- [ ] 错误处理和进程管理完善

**任务拆解**:
- [ ] Task-2.2.1: 创建 Python Worker 脚本（3h）
  ```python
  # server/python/asr_worker.py
  import sys
  import json
  from faster_whisper import WhisperModel
  ```
- [ ] Task-2.2.2: 实现 stdin/stdout 通信（2h）
- [ ] Task-2.2.3: 创建 WorkerManager 类（4h）
  ```typescript
  class WorkerManager {
    startWorker()
    stopWorker()
    sendTask()
  }
  ```
- [ ] Task-2.2.4: 实现进程池管理（3h）
  - 支持多个 Worker 实例
  - 负载均衡
- [ ] Task-2.2.5: 添加进程健康检查（2h）
- [ ] Task-2.2.6: 错误恢复机制（2h）

---

#### US-2.3 faster-whisper 转写服务
**作为** 用户
**我想要** 将音频转换为文字
**以便** 查看和编辑内容

**验收标准**:
- [ ] 转写准确率 ≥95%
- [ ] 返回带时间戳的分段文本
- [ ] 支持中英文自动检测
- [ ] 处理速度 ≥10x 实时速度

**任务拆解**:
- [ ] Task-2.3.1: 在 Python Worker 中加载 Whisper 模型（2h）
  ```python
  model = WhisperModel("large-v3", device="cuda")
  ```
- [ ] Task-2.3.2: 实现转写逻辑（4h）
  - VAD（语音活动检测）
  - 分段处理
  - 时间戳生成
- [ ] Task-2.3.3: 实现进度报告（2h）
- [ ] Task-2.3.4: 优化 GPU 使用（2h）
  - 批处理
  - 混合精度推理
- [ ] Task-2.3.5: 语言自动检测（1h）
- [ ] Task-2.3.6: 测试和性能调优（3h）

---

#### US-2.4 转写 API 端点
**作为** 前端开发者
**我想要** 调用转写 API
**以便** 启动转写任务

**验收标准**:
- [ ] POST /api/projects/:id/transcribe 接口
- [ ] 返回任务 ID
- [ ] 支持异步处理

**任务拆解**:
- [ ] Task-2.4.1: 实现转写 API 接口（3h）
- [ ] Task-2.4.2: 创建任务队列（4h）
  - 使用 Bull 或自己实现
  - 任务状态管理
- [ ] Task-2.4.3: 实现任务处理流程（4h）
  ```typescript
  async function processTranscription(projectId) {
    // 1. 提取音频
    // 2. 调用 Python Worker
    // 3. 保存结果
  }
  ```
- [ ] Task-2.4.4: 添加任务取消功能（2h）
- [ ] Task-2.4.5: 错误处理和重试（2h）

---

#### US-2.5 转写结果查询 API
**作为** 前端开发者
**我想要** 查询转写结果
**以便** 在界面上显示

**验收标准**:
- [ ] GET /api/projects/:id/transcription
- [ ] 返回分段文本和时间戳
- [ ] 支持进度查询

**任务拆解**:
- [ ] Task-2.5.1: 实现获取转写结果接口（2h）
- [ ] Task-2.5.2: 实现转写进度查询接口（2h）
  - GET /api/projects/:id/status
- [ ] Task-2.5.3: 数据格式化（1h）
  ```json
  {
    "segments": [
      {"id": "1", "start": 0, "end": 5, "text": "..."}
    ]
  }
  ```
- [ ] Task-2.5.4: 添加缓存机制（2h）

---

**Sprint 2 总结**:
- **总估时**: 约 55-60 小时
- **关键交付物**:
  - ✅ 音频提取功能
  - ✅ Python Worker 集成
  - ✅ 转写功能完整可用

---

## Sprint 3: 前端基础开发（Week 7-8）

### 目标
开发前端界面，实现文件上传、转写和结果展示

### User Stories

#### US-3.1 前端项目配置
**作为** 前端开发者
**我想要** 完整的前端开发环境
**以便** 开始 UI 开发

**验收标准**:
- [ ] React + TypeScript 项目运行正常
- [ ] Tailwind CSS 配置完成
- [ ] 路由和状态管理就绪

**任务拆解**:
- [ ] Task-3.1.1: 安装和配置 Tailwind CSS（1h）
- [ ] Task-3.1.2: 安装 React Router（30min）
- [ ] Task-3.1.3: 安装 Zustand 状态管理（30min）
- [ ] Task-3.1.4: 安装 axios 和 socket.io-client（30min）
- [ ] Task-3.1.5: 创建基础布局组件（2h）
  - Header, Sidebar, MainContent
- [ ] Task-3.1.6: 配置路由结构（1h）
  ```
  / - 首页/项目列表
  /project/:id - 项目详情
  /settings - 设置
  ```

---

#### US-3.2 API 客户端封装
**作为** 前端开发者
**我想要** 封装好的 API 客户端
**以便** 方便调用后端接口

**验收标准**:
- [ ] axios 统一配置
- [ ] 错误处理统一
- [ ] 类型定义完整

**任务拆解**:
- [ ] Task-3.2.1: 创建 API 客户端基类（2h）
  ```typescript
  // services/api.ts
  const api = axios.create({
    baseURL: 'http://localhost:8080'
  });
  ```
- [ ] Task-3.2.2: 实现项目相关 API（2h）
  - uploadFile, getProjects, getProject, deleteProject
- [ ] Task-3.2.3: 实现转写相关 API（1h）
  - startTranscription, getTranscription, getStatus
- [ ] Task-3.2.4: 添加请求拦截器（1h）
  - 添加 token（如果有认证）
  - 统一错误处理
- [ ] Task-3.2.5: 创建 TypeScript 类型定义（2h）

---

#### US-3.3 文件上传界面
**作为** 用户
**我想要** 简单易用的文件上传界面
**以便** 快速上传音视频文件

**验收标准**:
- [ ] 支持拖拽上传
- [ ] 支持文件选择器
- [ ] 显示上传进度
- [ ] 文件格式验证

**任务拆解**:
- [ ] Task-3.3.1: 创建 FileUploader 组件（3h）
  ```tsx
  <FileUploader
    onUpload={handleUpload}
    onProgress={handleProgress}
  />
  ```
- [ ] Task-3.3.2: 实现拖拽上传功能（2h）
- [ ] Task-3.3.3: 实现上传进度显示（2h）
  - 进度条
  - 百分比
  - 预估剩余时间
- [ ] Task-3.3.4: 添加文件类型验证（1h）
- [ ] Task-3.3.5: 美化 UI 样式（2h）

---

#### US-3.4 项目列表页面
**作为** 用户
**我想要** 查看所有上传的项目
**以便** 选择和管理它们

**验收标准**:
- [ ] 显示项目列表
- [ ] 显示项目状态（pending/processing/completed）
- [ ] 支持删除操作
- [ ] 点击项目进入详情

**任务拆解**:
- [ ] Task-3.4.1: 创建 ProjectList 组件（3h）
- [ ] Task-3.4.2: 实现项目卡片组件（2h）
  ```tsx
  <ProjectCard
    project={project}
    onDelete={handleDelete}
    onClick={handleClick}
  />
  ```
- [ ] Task-3.4.3: 实现状态筛选（1h）
- [ ] Task-3.4.4: 实现排序功能（1h）
- [ ] Task-3.4.5: 添加空状态提示（1h）
- [ ] Task-3.4.6: 实现分页（2h）

---

#### US-3.5 转写详情页面
**作为** 用户
**我想要** 查看转写结果
**以便** 阅读和使用文字内容

**验收标准**:
- [ ] 显示转写文本
- [ ] 显示时间戳
- [ ] 支持文本复制
- [ ] 转写中显示进度

**任务拆解**:
- [ ] Task-3.5.1: 创建 ProjectDetail 页面（2h）
- [ ] Task-3.5.2: 创建转写结果展示组件（3h）
  ```tsx
  <TranscriptionView
    segments={segments}
    isLoading={isLoading}
  />
  ```
- [ ] Task-3.5.3: 实现分段显示（2h）
  - 每个分段显示时间和文本
- [ ] Task-3.5.4: 添加开始转写按钮（1h）
- [ ] Task-3.5.5: 实现转写进度显示（2h）
  - 进度条
  - 状态提示
- [ ] Task-3.5.6: 添加复制功能（1h）

---

#### US-3.6 Zustand 状态管理
**作为** 前端开发者
**我想要** 统一的状态管理
**以便** 在各组件间共享数据

**验收标准**:
- [ ] Store 结构清晰
- [ ] 异步操作处理完善
- [ ] TypeScript 类型安全

**任务拆解**:
- [ ] Task-3.6.1: 创建 useAppStore（3h）
  ```typescript
  interface AppState {
    projects: Project[];
    currentProject: Project | null;
    // ...
  }
  ```
- [ ] Task-3.6.2: 实现项目相关 actions（2h）
  - loadProjects, selectProject, deleteProject
- [ ] Task-3.6.3: 实现转写相关 actions（2h）
  - startTranscription, loadTranscription
- [ ] Task-3.6.4: 添加 loading 和 error 状态（1h）

---

**Sprint 3 总结**:
- **总估时**: 约 45-50 小时
- **关键交付物**:
  - ✅ 前端基础界面
  - ✅ 文件上传功能
  - ✅ 项目列表和详情页

---

## Sprint 4: WebSocket 实时通信与 LLM 集成（Week 9-10）

### 目标
实现 WebSocket 实时推送和 AI 总结功能

### User Stories

#### US-4.1 WebSocket 服务端
**作为** 后端开发者
**我想要** WebSocket 实时通信
**以便** 推送转写进度

**验收标准**:
- [ ] Socket.io 服务正常运行
- [ ] 支持房间（room）管理
- [ ] 连接状态管理完善

**任务拆解**:
- [ ] Task-4.1.1: 安装 socket.io（30min）
  ```bash
  npm install socket.io
  ```
- [ ] Task-4.1.2: 集成 Socket.io 到 Fastify（2h）
- [ ] Task-4.1.3: 实现房间管理（2h）
  - 用户加入项目房间
  - 订阅/取消订阅
- [ ] Task-4.1.4: 实现进度推送（2h）
  ```typescript
  io.to(projectId).emit('progress', { stage, progress });
  ```
- [ ] Task-4.1.5: 连接认证（可选）（1h）

---

#### US-4.2 WebSocket 客户端
**作为** 前端开发者
**我想要** WebSocket 客户端
**以便** 接收实时更新

**验收标准**:
- [ ] 自动连接和重连
- [ ] 监听进度事件
- [ ] 错误处理完善

**任务拆解**:
- [ ] Task-4.2.1: 安装 socket.io-client（15min）
- [ ] Task-4.2.2: 创建 WebSocket 服务类（2h）
  ```typescript
  class WebSocketService {
    connect()
    subscribeToProject(projectId)
    onProgress(callback)
  }
  ```
- [ ] Task-4.2.3: 实现自动重连（1h）
- [ ] Task-4.2.4: 集成到 Zustand store（1h）
- [ ] Task-4.2.5: 添加连接状态指示器（1h）

---

#### US-4.3 实时进度显示
**作为** 用户
**我想要** 看到实时的转写进度
**以便** 了解处理状态

**验收标准**:
- [ ] 进度百分比实时更新
- [ ] 显示当前处理阶段
- [ ] 估算剩余时间

**任务拆解**:
- [ ] Task-4.3.1: 修改转写流程发送进度（2h）
  - 音频提取进度
  - 转写进度
- [ ] Task-4.3.2: 创建进度组件（2h）
  ```tsx
  <ProgressBar
    progress={progress}
    stage={stage}
  />
  ```
- [ ] Task-4.3.3: 实现阶段指示器（1h）
  - 音频提取 -> 转写中 -> 完成
- [ ] Task-4.3.4: 添加剩余时间估算（2h）

---

#### US-4.4 Ollama LLM 集成
**作为** 后端开发者
**我想要** 集成 Ollama 服务
**以便** 实现 AI 总结功能

**验收标准**:
- [ ] Ollama 服务自动管理
- [ ] API 调用正常工作
- [ ] 支持流式输出

**任务拆解**:
- [ ] Task-4.4.1: 创建 OllamaService 类（3h）
  ```typescript
  class OllamaService {
    async ensureRunning()
    async generate(prompt)
    async generateStream(prompt)
  }
  ```
- [ ] Task-4.4.2: 实现 Prompt 模板（2h）
  - 摘要生成 prompt
  - 要点提取 prompt
- [ ] Task-4.4.3: 实现流式输出（2h）
- [ ] Task-4.4.4: 错误处理和重试（2h）
- [ ] Task-4.4.5: 性能优化（1h）

---

#### US-4.5 AI 总结 API
**作为** 前端开发者
**我想要** 调用 AI 总结 API
**以便** 生成内容摘要

**验收标准**:
- [ ] POST /api/projects/:id/summarize
- [ ] 支持不同总结类型
- [ ] 返回结构化结果

**任务拆解**:
- [ ] Task-4.5.1: 实现总结 API 接口（3h）
- [ ] Task-4.5.2: 实现不同总结模式（3h）
  - 简短摘要
  - 详细摘要
  - 要点提取
- [ ] Task-4.5.3: 保存总结结果到数据库（1h）
- [ ] Task-4.5.4: 实现获取总结结果接口（1h）
  - GET /api/projects/:id/summary

---

#### US-4.6 总结结果展示
**作为** 用户
**我想要** 查看 AI 生成的总结
**以便** 快速了解内容要点

**验收标准**:
- [ ] 显示摘要内容
- [ ] 显示要点列表
- [ ] 支持重新生成

**任务拆解**:
- [ ] Task-4.6.1: 创建 SummaryPanel 组件（3h）
  ```tsx
  <SummaryPanel
    summary={summary}
    onRegenerate={handleRegenerate}
  />
  ```
- [ ] Task-4.6.2: 实现生成按钮和loading状态（1h）
- [ ] Task-4.6.3: 实现总结内容展示（2h）
- [ ] Task-4.6.4: 添加复制和导出功能（1h）
- [ ] Task-4.6.5: 实现流式显示（可选）（2h）

---

**Sprint 4 总结**:
- **总估时**: 约 45-50 小时
- **关键交付物**:
  - ✅ WebSocket 实时通信
  - ✅ AI 总结功能完整

---

## Sprint 5: 功能完善与部署（Week 11-12）

### 目标
完善 MVP 功能，优化性能，部署到生产环境

### User Stories

#### US-5.1 文本编辑功能
**作为** 用户
**我想要** 编辑转写结果
**以便** 修正错误

**验收标准**:
- [ ] 可以编辑文本
- [ ] 自动保存
- [ ] 保留时间戳

**任务拆解**:
- [ ] Task-5.1.1: 实现文本编辑器组件（4h）
- [ ] Task-5.1.2: 实现自动保存（2h）
- [ ] Task-5.1.3: 实现更新 API（2h）
  - PUT /api/projects/:id/transcription
- [ ] Task-5.1.4: 添加撤销/重做功能（2h）

---

#### US-5.2 导出功能
**作为** 用户
**我想要** 导出转写结果
**以便** 在其他软件中使用

**验收标准**:
- [ ] 支持 TXT 格式
- [ ] 支持 JSON 格式
- [ ] 支持 SRT 字幕格式（可选）

**任务拆解**:
- [ ] Task-5.2.1: 实现导出 API（3h）
  - GET /api/projects/:id/export?format=txt
- [ ] Task-5.2.2: 实现 TXT 导出（1h）
- [ ] Task-5.2.3: 实现 JSON 导出（1h）
- [ ] Task-5.2.4: 实现 SRT 导出（2h）
- [ ] Task-5.2.5: 前端添加导出按钮（1h）

---

#### US-5.3 错误处理优化
**作为** 用户
**我想要** 友好的错误提示
**以便** 知道发生了什么问题

**验收标准**:
- [ ] 所有错误都有提示
- [ ] 提示信息清晰易懂
- [ ] 提供解决建议

**任务拆解**:
- [ ] Task-5.3.1: 统一错误代码（2h）
- [ ] Task-5.3.2: 实现 Toast 提示组件（2h）
- [ ] Task-5.3.3: 添加错误边界（1h）
- [ ] Task-5.3.4: 完善各接口错误处理（3h）

---

#### US-5.4 性能优化
**作为** 开发者
**我想要** 优化应用性能
**以便** 提供更好的用户体验

**验收标准**:
- [ ] 前端加载时间 < 2s
- [ ] API 响应时间 < 100ms
- [ ] GPU 利用率 > 80%

**任务拆解**:
- [ ] Task-5.4.1: 前端代码分割（2h）
- [ ] Task-5.4.2: 图片和资源优化（1h）
- [ ] Task-5.4.3: API 响应缓存（2h）
- [ ] Task-5.4.4: 数据库查询优化（2h）
- [ ] Task-5.4.5: GPU 使用优化（3h）
  - 批处理优化
  - 内存管理

---

#### US-5.5 部署配置
**作为** 开发者
**我想要** 在生产环境部署应用
**以便** 实际使用

**验收标准**:
- [ ] PM2 配置完成
- [ ] 可以开机自启动
- [ ] 日志正常记录

**任务拆解**:
- [ ] Task-5.5.1: 创建 ecosystem.config.js（1h）
  ```javascript
  module.exports = {
    apps: [{
      name: 'miaoji-server',
      script: 'dist/server.js',
      instances: 1,
      exec_mode: 'fork',
      env: { NODE_ENV: 'production' }
    }]
  };
  ```
- [ ] Task-5.5.2: 配置环境变量（1h）
- [ ] Task-5.5.3: 编写启动脚本（1h）
- [ ] Task-5.5.4: 配置 PM2 开机自启（1h）
- [ ] Task-5.5.5: 配置 Windows 防火墙（30min）
- [ ] Task-5.5.6: 编写部署文档（2h）

---

#### US-5.6 测试与文档
**作为** 开发者
**我想要** 完整的测试和文档
**以便** 保证质量和可维护性

**验收标准**:
- [ ] 核心功能有单元测试
- [ ] API 文档完整
- [ ] 用户手册完成

**任务拆解**:
- [ ] Task-5.6.1: 编写后端单元测试（4h）
- [ ] Task-5.6.2: 编写前端组件测试（4h）
- [ ] Task-5.6.3: 编写 API 文档（2h）
- [ ] Task-5.6.4: 编写用户手册（3h）
- [ ] Task-5.6.5: 编写开发者文档（2h）

---

**Sprint 5 总结**:
- **总估时**: 约 50-55 小时
- **关键交付物**:
  - ✅ MVP 功能完整
  - ✅ 性能优化完成
  - ✅ 部署到生产环境
  - ✅ 文档完善

---

## 项目总结

### 总体时间估算
- **Sprint 0**: 30-35 小时（环境搭建）
- **Sprint 1**: 40-45 小时（后端基础）
- **Sprint 2**: 55-60 小时（AI 核心）
- **Sprint 3**: 45-50 小时（前端基础）
- **Sprint 4**: 45-50 小时（实时通信 + LLM）
- **Sprint 5**: 50-55 小时（完善与部署）

**总计**: 265-295 小时（约 8-10 周，按每周 30-35 小时计算）

### MVP 验收标准

#### 功能性
- [ ] 用户可以上传音视频文件
- [ ] 系统可以自动转写为文字（中英文）
- [ ] 用户可以查看和编辑转写结果
- [ ] 系统可以生成 AI 总结
- [ ] 用户可以导出结果（TXT, JSON）
- [ ] 支持局域网内多设备访问

#### 性能
- [ ] 转写速度 ≥10x 实时速度
- [ ] GPU 利用率 >70%
- [ ] API 响应时间 <100ms
- [ ] 前端加载时间 <2s

#### 稳定性
- [ ] 无严重 Bug
- [ ] 错误处理完善
- [ ] 日志记录完整
- [ ] 可以稳定运行 24 小时

### 风险管理

| 风险 | 概率 | 影响 | 应对措施 |
|------|------|------|---------|
| GPU 驱动问题 | 中 | 高 | 提前测试，准备 CPU 降级方案 |
| Python 集成问题 | 中 | 中 | 充分的技术验证（Sprint 0） |
| 性能不达标 | 低 | 高 | 持续性能监控和优化 |
| 时间超期 | 中 | 中 | 优先保证核心功能，次要功能延后 |

### 后续迭代计划（v1.1+）

#### 高优先级
- 音频同步播放
- 批量处理
- 更多导出格式（DOCX, PDF）
- 说话人分离

#### 中优先级
- 实时转写（麦克风）
- 多用户管理
- 自定义 Prompt
- 性能监控面板

#### 低优先级
- 移动端 App（独立项目）
- 云端备份
- 插件系统

---

## 附录

### 开发环境检查清单
```bash
# Node.js
node --version  # >= 18.0.0

# Python
python --version  # >= 3.10

# CUDA
nvcc --version  # >= 11.8
nvidia-smi  # 检查 GPU

# FFmpeg
ffmpeg -version

# Ollama
ollama --version
```

### 常用命令
```bash
# 后端开发
cd server
npm run dev

# 前端开发
cd web
npm run dev

# Python Worker 测试
cd server/python
python asr_worker.py

# 生产部署
pm2 start ecosystem.config.js
pm2 logs
pm2 monit
```

### 目录结构参考
```
miaoji/
├── server/
│   ├── src/
│   │   ├── api/
│   │   │   ├── projects.ts
│   │   │   ├── transcription.ts
│   │   │   └── summary.ts
│   │   ├── services/
│   │   │   ├── AudioExtractor.ts
│   │   │   ├── WorkerManager.ts
│   │   │   └── OllamaService.ts
│   │   ├── database/
│   │   │   ├── schema.sql
│   │   │   └── Database.ts
│   │   ├── utils/
│   │   └── server.ts
│   ├── python/
│   │   ├── asr_worker.py
│   │   └── requirements.txt
│   ├── uploads/
│   ├── dist/
│   └── package.json
│
├── web/
│   ├── src/
│   │   ├── components/
│   │   │   ├── FileUploader.tsx
│   │   │   ├── ProjectList.tsx
│   │   │   ├── TranscriptionView.tsx
│   │   │   └── SummaryPanel.tsx
│   │   ├── pages/
│   │   │   ├── HomePage.tsx
│   │   │   ├── ProjectDetailPage.tsx
│   │   │   └── SettingsPage.tsx
│   │   ├── services/
│   │   │   ├── api.ts
│   │   │   └── websocket.ts
│   │   ├── stores/
│   │   │   └── useAppStore.ts
│   │   ├── App.tsx
│   │   └── main.tsx
│   ├── public/
│   └── package.json
│
├── docs/
│   ├── 0.需求分析.md
│   ├── 1.技术架构设计.md
│   └── 2.MVP任务清单.md
│
└── README.md
```

---

**祝开发顺利！🚀**

