# Sprint 08: 移动端适配与系统优化

**Sprint 目标**：
在不破坏桌面端复杂交互体验的前提下，为移动端设备提供一套独立、简化且符合触控习惯的用户界面。采用"独立视图"策略，通过路由或组件分流实现双端共存。同时完善系统基础设施，包括后端日志系统，提升生产环境的可维护性和问题排查能力。

**周期**：2025-11-27 ~ 2025-11-28
**状态**：进行中 (In Progress)

---

## 1. User Stories (用户故事)

### US-8.1 架构分离与代码回滚
**As a** 开发者
**I want to** 回滚之前的 CSS 强适配代码，并建立双端路由分发机制
**So that** 桌面端能恢复完美的 IDE 体验，同时为移动端开发铺平道路。

### US-8.2 移动端基础布局 (Mobile Layout)
**As a** 手机用户
**I want to** 看到适应手机屏幕的导航栏
**So that** 我可以在不同页面间切换，且不会被桌面端的侧边栏占据屏幕空间。

### US-8.3 移动端核心页面 (Mobile Pages)
**As a** 手机用户
**I want to** 在手机上浏览项目列表和详情
**So that** 我可以随时随地查看转写进度和结果。

### US-8.4 移动端交互优化
**As a** 手机用户
**I want to** 在播放音频时能看到自动跟随的字幕，或者手动暂停跟随
**So that** 我既能获得流畅的听读体验，也能自由查看其他段落。

### US-8.5 后端日志系统
**As a** 开发者/系统管理员
**I want to** 在生产环境中拥有完善的日志系统
**So that** 能够记录系统运行状态、错误信息和调试信息，方便问题排查和系统监控。

**验收标准**:
- [x] 集成专业的日志库（如 Winston、Pino 等）
- [x] 支持不同日志级别（error、warn、info、debug）
- [x] 日志输出到文件和控制台
- [x] 支持日志轮转，避免日志文件过大
- [x] 关键操作和错误有详细的日志记录
- [x] 日志包含时间戳、请求ID等上下文信息

### US-8.6 系统设置页面重构
**As a** 用户
**I want to** 系统设置页面分成多个子页面
**So that** 可以更清晰地管理和查看不同的系统配置项

**验收标准**:
- [x] 系统设置页面支持 Tab 切换
- [x] 系统状态子页面：显示服务器访问信息、服务状态、移动端访问二维码
- [x] 存储路径管理子页面：管理存储路径配置
- [x] 移动端和桌面端都支持 Tab 切换
- [ ] URL 路由支持子页面导航（可选）

**任务拆解**:
- [x] Task-8.6.1: 重构 SettingsPage 为 Tab 结构，支持子页面切换（2h）(完成时间：2024-12-XX)
- [x] Task-8.6.2: 创建 SystemStatusTab 组件，包含系统状态相关内容（2h）(完成时间：2024-12-XX)
- [x] Task-8.6.3: 创建 StoragePathsTab 组件，包含存储路径管理（1h）(完成时间：2024-12-XX)
- [x] Task-8.6.4: 优化移动端 Tab 切换体验（1h）(完成时间：2024-12-XX)

---

## 2. 任务清单 (Task List)

### US-8.1 架构分离与代码回滚
- [x] **Task 8.1.1**: 回滚 `Layout`, `ProjectDetailPage`, `MediaPlayer` 等文件的 CSS 强适配修改。 (已完成)
- [x] **Task 8.1.2**: 引入 `useIsMobile` Hook 或类似机制检测设备类型。 (已完成)
- [x] **Task 8.1.3**: 修改 `App.tsx` 路由逻辑，根据设备类型渲染不同的 Layout 和 Page 组件。 (已完成)

### US-8.2 移动端基础布局
- [x] **Task 8.2.1**: 创建 `MobileLayout` 组件，实现顶部导航栏（列表/上传/设置）。 (已完成)
- [x] **Task 8.2.2**: 确保 `MobileLayout` 容器正确处理 SafeArea 和滚动区域。 (已完成)

### US-8.3 移动端核心页面
- [x] **Task 8.3.1**: 创建 `MobileProjectListPage`，复用 Store 逻辑，重写卡片式 UI。 (已完成)
- [x] **Task 8.3.2**: 创建 `MobileProjectDetailPage`，实现垂直堆叠布局 (Stack Layout)。 (已完成)
- [x] **Task 8.3.3**: 适配移动端播放器样式（音频固定高度，视频自适应）。 (已完成)
- [x] **Task 8.3.4**: 集成 `TranscriptionResult` 和 `SummaryPanel` 到移动端详情页。 (已完成)

### US-8.4 移动端交互优化 & Bug修复
- [x] **Task 8.4.1**: 修复移动端列表页的 TypeScript 类型报错。 (已完成)
- [x] **Task 8.4.2**: 验证移动端"自动跟随"开关是否工作正常（复用 `TranscriptionResult` 逻辑）。
- [x] **Task 8.4.3**: 检查移动端上传页 (`UploadPage`) 和设置页 (`SettingsPage`) 是否需要独立适配。（目前复用桌面端，需确认效果）
- [x] **Task 8.4.4**: 全面回归测试（桌面端是否受影响，手机端是否流畅）。

### US-8.5 后端日志系统
- [x] **Task 8.5.1**: 选择并集成日志库（推荐 Winston 或 Pino），配置日志级别和输出格式（2h）(完成时间：2024-12-XX)
- [x] **Task 8.5.2**: 配置日志输出到文件（`logs/app-YYYY-MM-DD.log`）和控制台，支持不同环境的不同配置（2h）(完成时间：2024-12-XX)
- [x] **Task 8.5.3**: 实现日志轮转功能，按日期自动轮转日志文件，避免单文件过大（2h）(完成时间：2024-12-XX)
- [x] **Task 8.5.4**: 在关键位置添加日志记录（API 请求/响应、错误处理、队列任务、文件操作等）（3h）(完成时间：2024-12-XX)
- [x] **Task 8.5.5**: 添加请求ID追踪，确保同一请求的日志可以关联（1h）(完成时间：2024-12-XX)
- [x] **Task 8.5.6**: 配置生产环境日志级别（仅记录 error、warn、info），开发环境可记录 debug（1h）(完成时间：2024-12-XX)

### US-8.6 系统设置页面重构
- [x] **Task 8.6.1**: 重构 SettingsPage 为 Tab 结构，支持子页面切换（2h）(完成时间：2024-12-XX)
- [x] **Task 8.6.2**: 创建 SystemStatusTab 组件，包含系统状态相关内容（2h）(完成时间：2024-12-XX)
- [x] **Task 8.6.3**: 创建 StoragePathsTab 组件，包含存储路径管理（1h）(完成时间：2024-12-XX)
- [x] **Task 8.6.4**: 优化移动端 Tab 切换体验（1h）(完成时间：2024-12-XX)

---

## 3. 验收标准 (Acceptance Criteria)

### 移动端适配
1.  **桌面端回归**：桌面端访问时，侧边栏、分栏布局、高度自适应等行为与 S06 结束时完全一致，无任何布局崩坏。
2.  **移动端识别**：使用手机（或浏览器窄屏模式）访问时，自动进入移动端视图。
3.  **导航体验**：移动端显示顶部导航栏，无左侧边栏。
4.  **详情页布局**：移动端详情页为"播放器在上、内容在下"的垂直流式布局，播放器不遮挡内容，内容区域可完整滚动。
5.  **功能完整**：双端均可正常播放、查看转写、切换自动跟随状态。

### 后端日志系统
6.  **日志记录**：所有 API 请求、错误、关键操作都有日志记录。✅
7.  **日志文件**：日志文件存储在 `logs/` 目录，支持按日期轮转（`app-YYYY-MM-DD.log`、`error-YYYY-MM-DD.log`）。✅
8.  **日志级别**：生产环境仅记录 error、warn、info，开发环境可记录 debug。✅
9.  **问题排查**：通过日志可以追踪请求流程、定位错误原因（包含请求ID、时间戳等上下文信息）。✅

## 4. 燃尽图 (Burn-down)
*（待补充）*
