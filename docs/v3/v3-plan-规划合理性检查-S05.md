# V3 规划合理性检查（含 Sprint-05）

**检查日期**：2026-02-06  
**结论**：Sprint-05「任务调度中心与可观测性」与现有 S01–S04 的依赖链**合理**，建议将容器化文档统一为 **Sprint 06**，避免与当前 S05 编号冲突。

---

## 1. 整体路线图（建议统一表述）

| 顺序 | Sprint | 内容 | 依赖 |
|------|--------|------|------|
| S01 | 模型抽象层 | ILLMProvider、多模型配置、前端设置 | - |
| S02 | 字幕 + 队列多类型 | 队列 type/Handler、SRT/VTT 导出、字幕压制、播放器字幕 | - |
| S03 | 翻译引擎 | translations 表、ChunkService、TranslationService、translate 入队 | S02 US-2.0 |
| S04 | 翻译前端 | 翻译触发、双语对照、译文导出 | S03 |
| **S05** | **任务调度中心与可观测性** | jobs 持久化、AI 链路追踪、任务看板 | S02 队列、S03 TranslationService、S01 ILLMProvider |
| S06 / 99 | 容器化 (Backlog) | Docker 镜像、Compose、GPU 透传 | 可选，时机成熟再做 |

---

## 2. Sprint-05 与各 Sprint 的依赖关系

- **S02**：S05 的 US-5.1 将队列从「内存」升级为「读写 SQLite」，前提是队列已有**多类型 + Handler 分发**（S02 US-2.0）。依赖关系正确。
- **S03**：US-5.2 在 `TranslationService` 中埋点记录 Prompt/Response，依赖 S03 的 TranslationService 存在。US-5.3 看板要展示「翻译/转写」任务，依赖 S02/S03 已产生的任务类型。合理。
- **S01**：US-5.2 要求「扩展 ILLMProvider 支持传入 jobId 上下文」，依赖 S01 的 ILLMProvider 接口。合理。
- **S04**：无直接依赖；S05 是后端与系统能力增强，放在 S04 之后顺序正确。

---

## 3. Sprint-05 内部一致性

- **US-5.1 → US-5.2 / US-5.3**：先有 `jobs` 表与队列持久化，再在业务中写 `jobs.logs`、再提供看板 API 与前端，顺序正确。
- **取消 (Cancel) 任务**：验收标准中「如果任务正在运行，尝试终止（需后端支持）」已标明需后端支持，可作为可选或后续迭代，不阻塞 S05。
- **Python Worker 进度**：Task-5.2.3 要求将 Whisper 进度/日志从 Python 转发到 Node 并写入 Job，需扩展当前 stdio 协议（如支持 `{"type":"log",...}` 行），工作量 1.5h 偏紧，可保留并在实现时视情况微调。

---

## 4. 需要统一的一点：Sprint 编号

- 当前 **v3-sprint-05.md** 已定义为「任务调度中心与可观测性」。
- **v3-sprint-99容器化.md** 内文仍写「Sprint 05：容器化部署」，与上冲突。

**建议**：将容器化文档中的「Sprint 05」统一改为 **Sprint 06**（或明确标注为 Backlog 的 Sprint 06），路线图末尾写「S06 (基建): Docker 容器化 / RAG / 其他」，与 v3-sprint-05.md 末尾的路线图一致。

---

## 5. 总结

- **V3 规划合理**：S01→S02→S03→S04→S05（任务调度中心）→S06/99（容器化）的先后顺序与依赖关系正确。
- **Sprint-05 内容**：任务持久化、AI 可观测性、任务看板放在「翻译前端闭环（S04）」之后，既能复用已有翻译/转写任务，又不会阻塞核心功能交付，时机合适。
- **建议操作**：在容器化文档中把「Sprint 05」改为「Sprint 06」，并在 S05 文档中写明前置依赖（S01/S02/S03/S04），便于后续排期与评审。
