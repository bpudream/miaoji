# Sprint 02: 字幕生产能力

**Sprint 目标**：
实现标准字幕文件 (SRT/VTT) 的生成与下载，并支持前端外挂字幕预览，为后续功能（翻译/压制）打基础。

**周期**：2026-02-13 ~ 2026-02-20
**状态**：已实现 (Implemented)

---

## User Stories

### US-2.0 任务队列多类型支持（前置依赖：Sprint-03 翻译任务入队）

**作为** 后端开发者
**我想要** 队列支持多种任务类型（转写 / 字幕压制 / 翻译等）并按类型分发
**以便** Sprint-02 的字幕压制与 Sprint-03 的翻译任务可以共用同一套队列，无需重复改造。

**验收标准**:

* [x] 定义任务类型枚举（如 `transcribe` | `burn_subtitle` | `translate`）及统一入队接口（如 `queue.add(type, payload)`）。
* [x] 按类型分发到对应 Handler；现有转写流程改为 `transcribe` 类型 Handler，行为与当前一致。
* [x] 新增任务类型时只需注册 Handler，无需修改队列核心逻辑。

**任务拆解**:

* [x] Task-2.0.1: 定义任务类型与 Payload 类型，改造 `queue.add(type, payload)` 及内部队列结构。（估时：1.5h）(完成时间：2026-02-06)
* [x] Task-2.0.2: 实现按类型分发与 Handler 注册机制，将现有转写流程抽成 `transcribe` Handler。（估时：2h）(完成时间：2026-02-06)

**说明**：本 US 为 Sprint-03「注册 translate 任务到队列系统」的前置能力；详见 `docs/v3/v3-后端任务队列检查.md`。

---

### US-2.1 字幕导出 (SRT/VTT)

**作为** 内容创作者
**我想要** 将转写结果下载为 SRT 或 VTT 格式的文件
**以便** 我可以将字幕导入到 Premiere/Final Cut Pro 中进行后期剪辑。

**验收标准**:

* [x] 详情页提供“导出 SRT”和“导出 VTT”按钮。
* [x] 下载的文件时间轴准确（精确到毫秒）。
* [x] 格式符合标准规范（SRT 序号/时间/内容，VTT Header）。

**任务拆解**:

* [x] Task-2.1.1: 在 `server/src/utils` 中实现 JSON 转 SRT 和 JSON 转 VTT 的工具函数。（估时：2h）(完成时间：2026-02-06)
* [x] Task-2.1.2: 新增后端 API `/api/export/:id/srt` 和 `/vtt`，设置正确的 Content-Disposition 头。（估时：1h）(完成时间：2026-02-06，复用 /api/projects/:id/export?format=)
* [x] Task-2.1.3: 前端详情页增加导出菜单组件。（估时：1h）(完成时间：2026-02-06，新增 VTT 选项)

---

### US-2.2 视频字幕硬压制 (Burn-in)

**作为** 视频分享者
**我想要** 直接生成一个带有硬字幕的 MP4 视频
**以便** 我可以直接发给没有字幕插件的观众观看。

**验收标准**:

* [ ] 本 Sprint 瘦身，压制功能延期到后续 Sprint。

**任务拆解**:

* [ ] Task-2.2.x: 延期（不在本 Sprint 实施）。

---

### US-2.3 播放器外挂字幕预览

**作为** 用户
**我想要** 在网页播放视频时能直接看到字幕
**以便** 我可以快速核对字幕的时间轴是否准确。

**验收标准**:

* [x] 视频播放器支持加载 VTT 字幕轨道 (`<track>`)。
* [x] 字幕随视频播放自动滚动显示。

**任务拆解**:

* [x] Task-2.3.1: 修改前端视频播放器组件，动态插入 `<track src="...">`。（估时：1h）(完成时间：2026-02-06)

---

## Sprint 02 总结

* **总估时**: 约 17 小时（含任务队列多类型抽象 3.5h）
* **关键交付物**:
* ✅ 任务队列多类型抽象（支持 transcribe，为 Sprint-03 translate 入队预留）
* ✅ SRT/VTT 导出功能
* ⏳ 视频字幕压制引擎 (FFmpeg 集成，延期)
* ✅ 播放器字幕预览支持



---
