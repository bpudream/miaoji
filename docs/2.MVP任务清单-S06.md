# Sprint 6: 多媒体联动与沉浸式稿面（Week 13-14）

### 目标
重构项目详情页布局，引入播放器面板，并实现段落与音/视频的联动播放体验。

### User Stories

#### US-6.1 多面板布局与分区滚动
**作为** 产品使用者
**我想要** 同时查看播放器、总结和转写内容
**以便** 在一个视图中快速理解与校对稿件

**验收标准**:
- [ ] 项目详情页改为「左 60% / 右 40%」的双栏布局
- [ ] 左侧再拆为上下两块（顶部播放器、底部 AI 总结）
- [ ] 各面板高度固定、支持独立滚动，不出现整页滚动条

**任务拆解**:
- [ ] Task-6.1.1: 重构 ProjectDetail 布局为自适应 Grid（6h）
- [ ] Task-6.1.2: 将播放面板与总结面板拆分为可复用组件（3h）
- [ ] Task-6.1.3: 为各面板添加固定高度与内部滚动（3h）
- [ ] Task-6.1.4: 处理响应式断点与大屏/小屏降级策略（2h）

---

#### US-6.2 播放器接入与段落联动
**作为** 用户
**我想要** 在网页中播放原音/视频并与转写段落联动
**以便** 快速核对内容并跳转到对应时间点

**验收标准**:
- [x] 内置音/视频播放控件，支持本地文件
- [x] 点击转写段落可跳转至对应的播放时间
- [x] 播放器状态可回写到段落（高亮当前段、显示播放进度）
- [x] 支持无视频输入时的纯音频模式

**任务拆解**:
- [x] Task-6.2.1: 集成视频/音频播放器组件与本地源加载（4h）(完成时间：2025-11-21)
- [x] Task-6.2.2: 建立段落时间戳到播放器的 seek 同步（6h）(完成时间：2025-11-21)
- [x] Task-6.2.3: 实现播放器 -> 段落的激活高亮与自动滚动（4h）(完成时间：2025-11-21)
- [x] Task-6.2.4: 设计播放控制面板（倍速、静音、循环）（3h）(完成时间：2025-11-21)
- [x] Task-6.2.5: 提供音频 fallback UI（2h）(完成时间：2025-11-21)

---

#### US-6.3 AI 面板增强（可选）
**作为** 用户
**我想要** 在观看/校对时获得更丰富的 AI 辅助信息
**以便** 迅速抓住重点并复用内容

**验收标准**:
- [ ] AI 总结面板支持多 Tab（概览/要点/行动项）
- [ ] 与播放器联动，可根据播放进度突出相关段落

**任务拆解**:
- [ ] Task-6.3.1: 重构 SummaryPanel 为多 Tab 结构（3h）
- [ ] Task-6.3.2: 替换为固定高度 + 内部滚动（1h）
- [ ] Task-6.3.3: 与播放器/段落的事件总线集成（4h）
- [ ] Task-6.3.4: 支持未来的评论/标记占位（2h）

---

#### US-6.4 转写润色与后处理
**作为** 用户/运营
**我想要** 在完成转写后获得可读性更强、带标点的稿件
**以便** 直接复用到文案、报告或字幕中

**验收标准**:
- [ ] 支持手动触发“润色”流程
- [ ] 使用 Ollama（或指定 LLM）对原始转写内容进行纠错、补充标点和段落
- [ ] 生成润色后的版本并保存（可回溯）
- [ ] UI 中可查看原文/润色稿的差异，避免误改

**任务拆解**:
- [ ] Task-6.4.1: 设计润色 Prompt 与输出模板（3h）
- [ ] Task-6.4.2: 在后端集成润色接口，调用 Ollama 对全文批处理（6h）
- [ ] Task-6.4.3: 建立润色结果的存储结构（含原文/润色版、时间戳）（4h）
- [ ] Task-6.4.4: 前端提供“润色”按钮与结果展示、对比 UI（6h）
- [ ] Task-6.4.5: 若润色失败，给出错误提示与重试入口（1h）

---

#### US-6.5 版本管理与回溯
**作为** 用户/运营
**我想要** 管理不同阶段的转写版本
**以便** 在润色和人工修改过程中随时回滚、对比、导出

**验收标准**:
- [ ] 系统内置三个阶段：V0（原始 Faster-Whisper 输出）、V1（AI 润色版）、Active Version（用户当前编辑中版本）
- [ ] 每次自动保存更新 Active Version
- [ ] 用户可以将当前 Active Version 另存为新版本（V2、V3 ...），也可以加载历史版本成为 Active Version
- [ ] 用户可以删除历史版本，但 **不得删除 V0/V1**
- [ ] 导出始终基于当前 Active Version

**任务拆解**:
- [ ] Task-6.5.1: 设计版本数据模型（版本表、关联转写内容、元数据）（4h）
- [ ] Task-6.5.2: 实现版本创建/读取/切换/删除 API（5h）
- [ ] Task-6.5.3: 前端版本管理面板（版本列表、另存、新建、删除、加载）（6h）
- [ ] Task-6.5.4: 自动保存与版本 API 联动，确保 Active Version 一致性（3h）
- [ ] Task-6.5.5: 导出逻辑切换为基于 Active Version 内容（1h）

---

#### US-6.6 页面布局优化与滚动控制
**作为** 用户
**我想要** 页面无主滚动条，所有内容在固定面板内滚动
**以便** 获得更沉浸的编辑体验，最大化文本内容显示空间

**验收标准**:
- [ ] 消除页面级滚动条，所有滚动限制在各面板内部
- [ ] 转写内容标题栏整合所有操作按钮（编辑、润色、版本、导出），节省纵向空间
- [ ] 确保各面板高度计算正确，无内容溢出

**任务拆解**:
- [ ] Task-6.6.1: 修复页面级滚动条问题，确保各面板独立滚动（2h）
- [ ] Task-6.6.2: 将编辑/润色/版本/导出按钮整合到转写标题栏（2h）
- [ ] Task-6.6.3: 优化面板高度计算与响应式布局（1h）

---

#### US-6.7 播放器模式切换与空间优化
**作为** 用户
**我想要** 根据媒体类型自动调整播放器模式，并优化空间分配
**以便** 在音频模式下为AI总结留出更多空间，在视频模式下优先显示视频

**验收标准**:
- [ ] 根据文件类型（音频/视频）自动判断播放模式
- [ ] 音频文件仅显示音频播放器，视频文件默认音频模式但可切换为视频
- [ ] 音频模式下播放器高度较小，为AI总结留出更多空间
- [ ] 视频模式下优先保证视频显示高度，AI总结区域可压缩

**任务拆解**:
- [ ] Task-6.7.1: 实现文件类型检测与播放模式判断（2h）
- [ ] Task-6.7.2: 实现音频/视频模式切换UI与逻辑（3h）
- [ ] Task-6.7.3: 根据播放模式动态调整面板高度分配（3h）

---

#### US-6.8 转写内容标题栏整合优化
**作为** 用户
**我想要** 所有转写相关操作集中在标题栏
**以便** 节省纵向空间，最大化文本内容显示区域

**验收标准**:
- [ ] 编辑、润色、版本、导出按钮统一放在转写内容标题栏
- [ ] 复制按钮保留在标题栏
- [ ] 移除独立的操作按钮行，节省纵向空间

**任务拆解**:
- [ ] Task-6.8.1: 重构 TranscriptionResult 组件，将操作按钮移至标题栏（2h）
- [ ] Task-6.8.2: 优化按钮布局与视觉层次（1h）

---

### Sprint 6 总结
- **总估时**: 约 58-65 小时（新增 13-15 小时）
- **关键交付物**:
  - ✅ 多面板布局与沉浸式稿面
  - ✅ 浏览器内播放控件与段落跳转
  - ✅ 面板级滚动与响应式体验
  - ✅ 转写润色与后处理能力
  - ✅ 版本管理与回溯机制
  - ✅ 页面滚动控制与空间优化
  - ✅ 播放器模式切换与动态布局

