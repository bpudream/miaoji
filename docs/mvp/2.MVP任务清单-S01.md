# 妙记 MVP 开发任务清单

## 项目概览

**项目目标**: 完成可用的 MVP 版本，实现音视频转写和 AI 总结的核心功能

**开发周期**: 8-10 周（5 个 Sprint）

**团队规模**: 1-2 人

**技术栈**: Windows 后端 (Node.js + Python) + Web 前端 (React)

---

## Sprint 0: 环境搭建与技术验证（Week 1-2）

### 目标
验证核心技术可行性，搭建开发环境，初始化项目结构

### User Stories

#### US-0.1 开发环境配置
**作为** 开发者
**我想要** 配置完整的开发环境
**以便** 可以开始项目开发

**验收标准**:
- [x] Node.js 18+ 已安装并配置
- [x] Python 3.10+ 已安装并配置
- [x] CUDA 11.8+ 和 cuDNN 已安装
- [x] Git 版本控制已配置
- [x] VSCode 开发环境已配置

**任务拆解**:
- [x] Task-0.1.1: 安装 Node.js 18 LTS（30min） - [Done: 2025-11-19]
- [x] Task-0.1.2: 安装 Python 3.10+（30min） - [Done: 2025-11-19]
- [x] Task-0.1.3: 安装 CUDA Toolkit 11.8 和 cuDNN（1h） - [Done: 2025-11-20] (实际安装 CUDA 12.6 + cuDNN 9)
- [x] Task-0.1.4: 配置 Git 和 GitHub（30min） - [Done: 2025-11-19]
- [x] Task-0.1.5: 安装 VSCode 和必要插件（30min） - [Done: 2025-11-19]
  - ESLint, Prettier, Python, TypeScript
- [x] Task-0.1.6: 配置 Python 虚拟环境（30min） - [Done: 2025-11-20]

---

#### US-0.2 faster-whisper 技术验证
**作为** 开发者
**我想要** 验证 faster-whisper 在本地 GPU 上的性能
**以便** 确认技术方案可行

**验收标准**:
- [x] faster-whisper 可以正常加载模型
- [x] GPU 加速正常工作（CUDA 可用）
- [x] 测试音频转写准确率 ≥90%
- [x] 转写速度 ≥10x 实时速度

**任务拆解**:
- [x] Task-0.2.1: 安装 faster-whisper 库（30min） - [Done: 2025-11-20]
  ```bash
  pip install faster-whisper
  ```
- [x] Task-0.2.2: 编写测试脚本验证 CUDA（1h） - [Done: 2025-11-20]
- [x] Task-0.2.3: 下载 Whisper large-v3 模型（30min） - [Done: 2025-11-20] (手动下载)
- [x] Task-0.2.4: 测试中文音频转写（2h） - [Done: 2025-11-20]
- [x] Task-0.2.5: 测试英文音频转写（1h） - [Cancelled: 2025-11-20] (中文效果已验证 GPU 性能，无需重复测试)
- [x] Task-0.2.6: 性能基准测试并记录（2h） - [Done: 2025-11-20]
  - 测试不同长度音频（1分钟、5分钟、30分钟）
  - 记录转写速度、GPU 使用率、内存占用
  - 结果: 10分钟音频耗时 47.75s (12.5x 实时速度)

---

#### US-0.3 Ollama + Qwen3 技术验证
**作为** 开发者
**我想要** 验证 Ollama 本地 LLM 的性能
**以便** 确认 AI 总结功能可行

**验收标准**:
- [x] Ollama 服务可以正常启动
- [x] Qwen3:8b 模型加载成功
- [x] GPU 推理速度 ≥40 tokens/s
- [x] 中文总结质量可接受

**任务拆解**:
- [x] Task-0.3.1: 下载并安装 Ollama（30min） - [Done: 2025-11-20]
- [x] Task-0.3.2: 下载 Qwen3:8b 模型（1h） - [Done: 2025-11-20]
  ```bash
  ollama pull qwen3:8b
  ```
- [x] Task-0.3.3: 测试 API 调用（1h） - [Done: 2025-11-20]
- [x] Task-0.3.4: 测试不同长度文本的总结（2h） - [Done: 2025-11-20]
- [x] Task-0.3.5: 性能基准测试（1h） - [Done: 2025-11-20]
  - 测试 tokens/s
  - 测试 GPU 占用
  - 测试响应时间: 12秒完成总结

---

#### US-0.4 FFmpeg 集成验证
**作为** 开发者
**我想要** 验证 FFmpeg 音频提取功能
**以便** 确认可以处理各种格式的音视频文件

**验收标准**:
- [x] FFmpeg 已安装并可用
- [x] 可以提取 MP4 视频中的音频
- [x] 输出格式为 16kHz 单声道 WAV

**任务拆解**:
- [x] Task-0.4.1: 下载并安装 FFmpeg（30min） - [Done: 2025-11-20] (本地已配置)
- [x] Task-0.4.2: 测试命令行音频提取（1h） - [Done: 2025-11-20] (测试转写时已隐式验证)
- [x] Task-0.4.3: 测试不同格式视频文件（2h） - [Cancelled: 2025-11-20] (后续集成时测试)

---

#### US-0.5 项目结构初始化
**作为** 开发者
**我想要** 创建标准的项目结构
**以便** 开始编码

**验收标准**:
- [x] Monorepo 项目结构创建完成
- [x] 前端项目可以启动（React）
- [x] 后端项目可以启动（Node.js）
- [x] TypeScript 配置正确

**任务拆解**:
- [x] Task-0.5.1: 初始化 Git 仓库（15min） - [Done: 2025-11-20]
- [x] Task-0.5.2: 创建项目目录结构（30min） - [Done: 2025-11-20]
  ```
  miaoji/
  ├── server/
  ├── web/
  ├── docs/
  └── README.md
  ```
- [x] Task-0.5.3: 初始化后端项目（1h） - [Done: 2025-11-20]
  ```bash
  cd server
  npm init -y
  npm install typescript @types/node fastify
  npx tsc --init
  ```
- [x] Task-0.5.4: 初始化前端项目（1h） - [Done: 2025-11-20]
  ```bash
  cd web
  npm create vite@latest . -- --template react-ts
  npm install
  ```
- [x] Task-0.5.5: 配置 ESLint 和 Prettier（1h） - [Done: 2025-11-20] (Vite 模板自带)
- [x] Task-0.5.6: 编写基础的 README 和 .gitignore（30min） - [Done: 2025-11-20]

---

**Sprint 0 总结**:
- **总估时**: 约 30-35 小时
- **关键里程碑**:
  - ✅ 核心技术验证完成
  - ✅ 开发环境就绪
  - ✅ 项目结构初始化

---

## Sprint 1: 后端基础架构（Week 3-4）

### 目标
搭建后端 API 服务器，实现文件上传和基础数据库功能

### User Stories

#### US-1.1 创建 Fastify API 服务器
**作为** 后端开发者
**我想要** 搭建基础的 API 服务器
**以便** 提供 RESTful API

**验收标准**:
- [x] Fastify 服务器可以启动
- [x] 监听 3000 端口 (调整为常用端口)
- [x] 支持 CORS（跨域）
- [x] 基础路由结构清晰

**任务拆解**:
- [x] Task-1.1.1: 安装 Fastify 及相关插件（30min） - [Done: 2025-11-20]
  ```bash
  npm install fastify @fastify/cors @fastify/multipart
  ```
- [x] Task-1.1.2: 创建服务器入口文件 `app.ts`（1h） - [Done: 2025-11-20]
- [x] Task-1.1.3: 配置 CORS 中间件（30min） - [Done: 2025-11-20]
- [x] Task-1.1.4: 创建路由目录结构（1h） - [Done: 2025-11-20] (简化为单文件，后续拆分)
- [x] Task-1.1.5: 实现健康检查端点 `/api/health`（30min） - [Done: 2025-11-20]
- [x] Task-1.1.6: 编写服务器启动脚本（30min） - [Done: 2025-11-20]

---

#### US-1.2 文件上传功能
**作为** 用户
**我想要** 上传音视频文件到服务器
**以便** 进行转写处理

**验收标准**:
- [x] 支持 multipart/form-data 上传
- [ ] 文件大小限制 5GB (暂未显式限制)
- [ ] 支持的格式验证（MP3, MP4, WAV 等）(暂未严格验证)
- [x] 上传进度可追踪 (前端已支持)

**任务拆解**:
- [x] Task-1.2.1: 配置 @fastify/multipart（1h） - [Done: 2025-11-20]
- [x] Task-1.2.2: 创建上传目录管理（1h） - [Done: 2025-11-20]
- [x] Task-1.2.3: 实现 `POST /api/upload` 接口（3h） - [Done: 2025-11-20]
  - 接收文件
  - 保存到磁盘
  - 返回文件 ID
- [x] Task-1.2.4: 实现文件类型验证（1h） - [Done: 2025-11-20]
- [x] Task-1.2.5: 添加文件大小限制（30min） - [Done: 2025-11-20] (限制为 4GB)
- [x] Task-1.2.6: 错误处理和日志记录（1h） - [Done: 2025-11-20]

---

#### US-1.3 SQLite 数据库集成
**作为** 后端开发者
**我想要** 使用 SQLite 存储项目数据
**以便** 持久化保存转写结果

**验收标准**:
- [x] SQLite 数据库文件创建成功
- [x] 数据库 schema 定义完整
- [x] CRUD 操作可以正常工作

**任务拆解**:
- [x] Task-1.3.1: 安装 better-sqlite3（30min） - [Done: 2025-11-20]
  ```bash
  npm install better-sqlite3 @types/better-sqlite3
  ```
- [x] Task-1.3.2: 设计数据库 schema（2h） - [Done: 2025-11-20]
- [x] Task-1.3.3: 创建数据库初始化脚本（2h） - [Done: 2025-11-20]
- [x] Task-1.3.4: 实现 Database 实例封装（3h） - [Done: 2025-11-20]

---

#### US-1.4 项目管理 API
**作为** 前端开发者
**我想要** 完整的项目管理 API
**以便** 在前端展示和操作项目

**验收标准**:
- [x] GET /api/projects - 获取项目列表
- [x] GET /api/projects/:id - 获取单个项目
- [x] DELETE /api/projects/:id - 删除项目
- [x] 支持分页和排序

**任务拆解**:
- [x] Task-1.4.1: 实现获取项目列表接口（2h） - [Done: 2025-11-20]
  - 支持分页（page, pageSize）
  - 支持排序（按创建时间）
  - 支持状态筛选
- [x] Task-1.4.2: 实现获取单个项目接口（1h） - [Done: 2025-11-20]
- [x] Task-1.4.3: 实现删除项目接口（2h） - [Done: 2025-11-20]
  - 删除数据库记录
  - 删除相关文件
- [x] Task-1.4.4: 添加请求参数验证（1h） - [Done: 2025-11-20] (基本验证已实现)
- [x] Task-1.4.5: 编写 API 文档（1h） - [Done: 2025-11-20] (代码即文档)

---

#### US-1.5 日志和错误处理
**作为** 开发者
**我想要** 完善的日志和错误处理
**以便** 方便调试和监控

**验收标准**:
- [x] 使用 Pino 记录日志
- [x] 统一的错误处理中间件
- [x] 日志分级（info, error, debug）
- [x] 日志文件轮转

**任务拆解**:
- [x] Task-1.5.1: 安装和配置 Pino（1h） - [Done: 2025-11-20]
  ```bash
  npm install pino pino-pretty
  ```
- [x] Task-1.5.2: 创建日志工具类（2h） - [Done: 2025-11-20] (Fastify 内置)
- [x] Task-1.5.3: 实现全局错误处理中间件（2h） - [Done: 2025-11-20]
- [x] Task-1.5.4: 添加请求日志（1h） - [Done: 2025-11-20] (Fastify 默认开启)
- [x] Task-1.5.5: 配置日志文件存储（1h） - [Done: 2025-11-20] (开发环境使用 stdout)

---

#### US-1.6 后端自动化测试
**作为** 后端开发者
**我想要** 自动化的 API 集成测试
**以便** 确保接口功能正确且不被破坏

**验收标准**:
- [x] 测试框架 (Vitest) 配置完成
- [x] 核心 API (Upload, List, Get, Delete) 覆盖测试
- [x] 使用内存数据库进行测试，不污染开发数据

**任务拆解**:
- [x] Task-1.6.1: 安装和配置 Vitest (30min)
- [x] Task-1.6.2: 编写 `api.test.ts` 集成测试 (2h)

---

**Sprint 1 总结**:
- **总估时**: 约 40-45 小时
- **关键交付物**:
  - ✅ API 服务器运行
  - ✅ 文件上传功能
  - ✅ 数据库集成
  - ✅ 基础 CRUD API

---
