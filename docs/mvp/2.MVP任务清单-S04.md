# Sprint 4: LLM 集成与高级功能（Week 9-10）

### 目标
集成 Ollama 实现 AI 总结功能，并进行系统级优化。

### User Stories

#### US-4.1 Ollama LLM 集成
**作为** 后端开发者
**我想要** 集成 Ollama 服务
**以便** 实现 AI 总结功能

**验收标准**:
- [x] Ollama 服务自动管理或连接
- [x] API 调用正常工作
- [x] 支持流式输出

**任务拆解**:
- [x] Task-4.1.1: 创建 OllamaService 类（3h） (Done: 2025-11-20)
  ```typescript
  class OllamaService {
    async ensureRunning()
    async generate(prompt)
    async generateStream(prompt)
  }
  ```
- [x] Task-4.1.2: 实现 Prompt 模板（2h） (Done: 2025-11-20)
  - 摘要生成 prompt
  - 要点提取 prompt
- [x] Task-4.1.3: 实现流式输出（2h） (Done: 2025-11-20)
- [x] Task-4.1.4: 错误处理和重试（2h） (Done: 2025-11-20)
- [x] Task-4.1.5: 性能优化（1h） (Done: 2025-11-20)

---

#### US-4.2 AI 总结 API
**作为** 前端开发者
**我想要** 调用 AI 总结 API
**以便** 生成内容摘要

**验收标准**:
- [x] POST /api/projects/:id/summarize
- [x] 支持不同总结类型
- [x] 返回结构化结果

**任务拆解**:
- [x] Task-4.2.1: 实现总结 API 接口（3h） (Done: 2025-11-20)
- [x] Task-4.2.2: 实现不同总结模式（3h） (Done: 2025-11-20)
  - 简短摘要
  - 详细摘要
  - 要点提取
- [x] Task-4.2.3: 保存总结结果到数据库（1h） (Done: 2025-11-20)
- [x] Task-4.2.4: 实现获取总结结果接口（1h） (Done: 2025-11-20)
  - GET /api/projects/:id/summary

---

#### US-4.3 总结结果展示
**作为** 用户
**我想要** 查看 AI 生成的总结
**以便** 快速了解内容要点

**验收标准**:
- [x] 显示摘要内容
- [x] 显示要点列表
- [x] 支持重新生成

**任务拆解**:
- [x] Task-4.3.1: 创建 SummaryPanel 组件（3h） (Done: 2025-11-20)
  ```tsx
  <SummaryPanel
    summary={summary}
    onRegenerate={handleRegenerate}
  />
  ```
- [x] Task-4.3.2: 实现生成按钮和loading状态（1h） (Done: 2025-11-20)
- [x] Task-4.3.3: 实现总结内容展示（2h） (Done: 2025-11-20)
- [x] Task-4.3.4: 添加复制和导出功能（1h） (Done: 2025-11-20)
- [x] Task-4.3.5: 实现流式显示（可选）（2h） (Done: 2025-11-20)

---

#### US-4.4 实时通信优化 (WebSocket) - [Optional/Low Priority] (Skipped: 2025-11-20)
**说明**: 由于采用了智能轮询策略，WebSocket 仅作为进一步降低延迟的优化选项，优先级调低。

**作为** 后端开发者
**我想要** WebSocket 实时通信
**以便** 推送转写进度

**任务拆解**:
- [ ] ~~Task-4.4.1: 集成 Socket.io 到 Fastify（2h）~~
- [ ] ~~Task-4.4.2: 实现进度推送（2h）~~
- [ ] ~~Task-4.4.3: 前端集成 socket.io-client（2h）~~

---

**Sprint 4 总结**:
- **总估时**: 约 30-40 小时
- **关键交付物**:
  - ✅ AI 总结功能完整
  - ✅ LLM 服务集成

